pipeline {
	agent {label'master'}


	environment{
		TOMCAT_USER="ubuntu"
		TOMCAT_HOST="13.201.187.70"
		TOMCAT_PATH="/home/ubuntu/tomcat/webapps"
	
		  
                
	}
	stages {
		stage('Checkout') {
			steps {
				echo 'Checkout completed'
				git branch: 'main', url: 'https://github.com/guruvenkatakrishna/java-example.git'
			}
		}
		stage('test') {
			steps {
				echo 'This is test on code.Assume it is tested'
			}
		}
		stage('Build') {
			steps {
				sh 'mvn clean install'
			}
		}
		stage('Deploy') {
			
	
			steps {
				echo 'Deploying into environment'
				// Ensure the target directory exists on the remote server
			        sh '''
            				ssh ubuntu@13.201.187.70 "mkdir -p /home/ubuntu/tomcat/webapps"
            		
       				 '''

				sh '''
					rsync -avz -e ssh /var/lib/jenkins/workspace/tomcat/webapp/target/*.war ubuntu@13.201.187.70:/home/ubuntu/tomcat/webapps
				'''
			}
			
		}
	}
}
